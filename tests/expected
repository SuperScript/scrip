

#### scrip help offers help

  scrip mode file...
 
    help
      Print this helpful message
 
    deps file...
      Print the list of included file paths
      Path is printed only the first time encountered
      Paths are sorted by order of encounter
 
    code file...
      Print the code in files, resolving includes
      Includes are inserted only the first time encountered
 
0


#### scrip deps lists dependencies

.../tests/basedir/scriptest
.../lib/safe.sh
.../lib/barf.sh
.../lib/shout.sh
0


#### shout prints message to stderr

.../tests/basedir/shout_test: test message
0


#### shout.awk prints message to stderr

awk: test message
0


#### barf prints fatal message and exits with 111

.../tests/basedir/barf_test: fatal: test error
111


#### barf.awk prints fatal message and exits with 111

awk: fatal: test error
111


#### scrip code resolves includes

#!/bin/sh
shout() { echo "$0: $*" >&2; }
barf() { shout "fatal: $*"; exit 111; }
safe() { "$@" || barf "cannot $*"; }
safe nosuchprogram
0


#### safe succeeds with valid command

hello world
0


#### safe fails and shows error

.../tests/basedir/safe_fail: fatal: cannot false
111


#### atomic_to writes output atomically on success

test content
0


#### atomic_to cleans up on failure

OK: basedir/fail_output.txt does not exist
0


#### atomic_to_mode writes output with correct mode

-rwxr-xr-x
#!/bin/sh
0


#### atomic_to_mode cleans up on failure

OK: basedir/fail_script.sh does not exist
0


#### compose pipes two commands

Hello world
0


#### compose chains multiple commands

line1
0


#### compose with single command (no separator)

no pipe here
0


#### compose with do_ works

thereugo
hereur
0


#### compose with do_run works

THEREUGO
HEREUR
0


#### compose with do_xrun works

X: HEREUR
X: THEREUGO
0
